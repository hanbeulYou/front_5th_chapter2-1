import"./modulepreload-polyfill-B5Qt9EMX.js";import{f as h,a as y,B as C,T as E,P as d,b,c as x,A as $,F as I,d as k,S as R,D as u,e as i,g as H,h as Q,i as F,j as Y,k as T,l as f}from"./suggest-Bjb6z1d6.js";const c=(t,{id:e,className:n,attributes:a={},textContent:o}={})=>{const s=document.createElement(t);return e&&(s.id=e),n&&(s.className=n),o&&(s.textContent=o),Object.entries(a).forEach(([r,m])=>{s.setAttribute(r,m)}),s},U=t=>document.getElementById(t),D=t=>Number.parseInt(t.querySelector("span").dataset.quantity,10),P=(t,e,n)=>{const a=t.querySelector("span");a.dataset.quantity=n,a.textContent=`${e.name} - ${h(e.value)} x ${n}`},X=(t,e)=>Math.round(t*(1-e)),w=(t,e,n,a)=>{P(t,e,n),e.quantity-=a},W=(t,e,n)=>{t.remove(),e.quantity-=n},G=(t,e,n)=>{const a=parseInt(t.dataset.change,10),o=D(n),s=o+a,r=e.quantity+o;if(s<=0){W(n,e,a);return}if(s>r){y();return}w(n,e,s,a)},V=(t,e)=>{if(!t||t.quantity<=0)return;const n=U(t.id);if(n){const a=D(n)+1;if(a<=t.quantity)P(n,t,a),t.quantity--;else{y();return}}else{const a=gt(t);e.appendChild(a),t.quantity--}},M=t=>{const e={...t};return{get:o=>o?e[o]:{...e},set:(o,s)=>{e[o]!==s&&(e[o]=s)}}},l=M({itemCount:0,subTotal:0,totalAmount:0}),L=M({selectedProduct:null}),j=(t,e,n)=>{if(t<C.THRESHOLD)return(n-e)/n;const a=e*C.DISCOUNT_RATE,o=n-e;return a>o?(l.set("totalAmount",n*(1-C.DISCOUNT_RATE)),C.DISCOUNT_RATE):o/n},K=t=>{if(!(new Date().getDay()===E.DAY))return t;const n=l.get("totalAmount")*(1-E.DISCOUNT_RATE);return l.set("totalAmount",n),Math.max(t,E.DISCOUNT_RATE)},z=(t,e,n)=>{const a=j(t,e,n);return K(a)},J=t=>t.reduce((e,n)=>{const a=d.find(m=>m.id===n.id);if(!a)return e;const o=parseInt(n.querySelector("span").dataset.quantity,10),s=a.value*o,r=o>=10?b[a.id]??0:0;return e.itemCount+=o,e.subTotal+=s,e.totalAmount+=s*(1-r),e},{itemCount:0,subTotal:0,totalAmount:0}),_=()=>{const t=[...S.get().children],{itemCount:e,subTotal:n,totalAmount:a}=J(t);l.set("itemCount",e),l.set("subTotal",n),l.set("totalAmount",a);const o=z(e,a,n);It(a,o),dt(),Tt()},Z=(t,e)=>{const n=D(e);t.quantity+=n,e.remove()},tt=t=>d.find(e=>e.id!==t&&e.quantity>0),et=(t,e=$.RATE)=>{t.value=Math.round(t.value*(1-e))},nt=()=>{const t=L.get("selectedProduct");if(!t)return;const e=tt(t);e&&(x(e),et(e),O())},at=t=>t[Math.floor(Math.random()*t.length)],ot=t=>Math.random()<.3&&t.quantity>0,st=(t,e=I.DISCOUNT_RATE)=>{t.value=X(t.value,e)},it=()=>{const t=at(d);ot(t)&&(st(t),k(t),O())},N=(t,e,n)=>{const a=Math.random()*n;setTimeout(()=>{setInterval(t,e)},a)},ct=()=>{N(it,I.INTERVAL,I.MAX_INITIAL_DELAY),N(nt,R.INTERVAL,R.MAX_INITIAL_DELAY)},rt=()=>{const t=S.get(),n=p.get().value,a=d.find(o=>o.id===n);V(a,t),_(),L.set("selectedProduct",n)},v={_element:null,init(){this._element=c("button",{id:u.PRODUCT.ADD_BUTTON,className:i.BUTTON.PRIMARY,textContent:"추가"}),this._element.addEventListener("click",()=>{rt()})},get(){return this._element}},ut=t=>{const e=t.target,n=e.dataset.productId,a=U(n),o=d.find(s=>s.id===n);!a||!o||(e.classList.contains("quantity-change")?G(e,o,a):e.classList.contains("remove-item")&&Z(o,a),_())},S={_element:null,init(){this._element=document.createElement("div"),this._element.id=u.CART.CONTAINER,this._element.addEventListener("click",t=>ut(t))},get(){return this._element}},B={_appRoot:document.getElementById(u.APP),_mainContainer:null,_mainWrapper:null,_mainHeader:null,init(){this._mainContainer=c("div",{id:"main-container",className:i.CONTAINER.MAIN}),this._mainWrapper=c("div",{id:"main-wrapper",className:i.CONTAINER.WRAPPER}),this._mainHeader=c("h1",{id:"main-header",className:i.HEADER.TITLE,textContent:"장바구니"})},get(){return{mainAppRoot:this._appRoot,mainContainer:this._mainContainer,mainWrapper:this._mainWrapper,mainHeader:this._mainHeader}}},p={_productSelect:null,init(){this._productSelect=document.createElement("select"),this._productSelect.id=u.PRODUCT.SELECT,this._productSelect.className=i.FORM.SELECT},get(){return this._productSelect}},g={_element:null,init(){this._element=document.createElement("div"),this._element.id=u.PRODUCT.STOCK_STATUS,this._element.className=i.TEXT.STOCK},get(){return this._element}},A={_totalAmountContainer:null,init(){this._totalAmountContainer=document.createElement("div"),this._totalAmountContainer.id=u.CART.TOTAL,this._totalAmountContainer.className=i.TEXT.TOTAL},get(){return this._totalAmountContainer}},lt=t=>c("option",{attributes:{value:t.id,...t.quantity===0&&{disabled:!0}},textContent:H(t)}),O=()=>{const t=p.get(),e=document.createDocumentFragment();d.forEach(n=>{e.appendChild(lt(n))}),t.replaceChildren(e)},dt=()=>{const t=g.get(),e=d.reduce((n,a)=>n+Q(a),"");t.textContent=e},mt=t=>{let e=document.getElementById(u.CART.POINTS);return e||(e=c("span",{id:u.CART.POINTS,className:i.TEXT.SUCCESS}),t.appendChild(e)),e},Tt=()=>{const t=A.get(),e=l.get("totalAmount"),n=F(e),a=mt(t);a.textContent=`(포인트: ${n})`},Ct=()=>{p.init(),A.init(),g.init(),S.init(),v.init(),B.init()},St=()=>{const t=p.get(),e=A.get(),n=g.get(),a=S.get(),o=v.get(),{mainAppRoot:s,mainContainer:r,mainWrapper:m,mainHeader:q}=B.get();m.append(q,a,e,t,o,n),r.appendChild(m),s.appendChild(r)},pt=()=>{O(),_()},At=()=>{Ct(),St(),pt()},Et=t=>c("span",{className:i.TEXT.DISCOUNT,textContent:`(${Y(t)} 할인 적용)`}),It=(t,e)=>{const n=A.get(),a=n.querySelector(`.${i.TEXT.DISCOUNT}`);if(a&&a.remove(),n.textContent=`총액: ${h(t)}`,e>0){const o=Et(e);n.appendChild(o)}},ht=({change:t,text:e,itemId:n})=>c("button",{className:`${i.BUTTON.PRIMARY} ${i.BUTTON.SMALL} ${f.BUTTON.QUANTITY_CHANGE}`,attributes:{[T.PRODUCT.ID]:n,[T.PRODUCT.CHANGE]:t},textContent:e}),Dt=t=>c("button",{className:`${i.BUTTON.DANGER} ${f.BUTTON.REMOVE_ITEM}`,attributes:{[T.PRODUCT.ID]:t},textContent:"삭제"}),_t=t=>c("span",{attributes:{[T.PRODUCT.VALUE]:t.value,[T.PRODUCT.QUANTITY]:1},textContent:`${t.name} - ${h(t.value)} x 1`}),gt=t=>{const e=c("div",{id:t.id,className:i.LAYOUT.FLEX});e.appendChild(_t(t));const n=c("div");return[{change:-1,text:"-"},{change:1,text:"+"}].forEach(a=>{n.appendChild(ht({...a,itemId:t.id}))}),n.appendChild(Dt(t.id)),e.appendChild(n),e},Ot=()=>{At(),ct()};Ot();
